---
layout: post
title: Universal Analytics User-ID使用心得
category : Universal Analytics
tags : [User-ID, Universal Analytics, Google Tag Manager]
---
{% include JB/setup %}

我的一个GA账户今天已经开通了User-ID功能，这里记录一些使用心得。

总体来说，这是一个很时髦的功能，主要得益于近年来跨屏用户的不断增长，以及移动设备地增长率不断攀升。以用户为中心的数据分析，是如今大家都基本达成的一个共识，对于普遍意义的数据分析而言，服务器日志时代早已远去（当前主要应用于SEO的后端分析），IP时代渐行渐远，Cookie是目前主要及主流的跟踪方式。

Google Analytics推出的这个User-ID功能其实在去年的开发者大会就已经曝光了，直到前些天才开始逐步开放测试范围，应该最近一两个月内所有账户都可以用上这个功能了。

## 新增功能：

1.在受众群体的菜单下新增了一个“跨设备”的子菜单，其下再有“设备重叠”、“设备路径”、“流量获取设备”。

2.设备路径中支持主要维度的细分，并且可以对基本的转化数据和电子商务数据使用“定序工具”，所谓“定序工具”，其实就是一个针对设备流向的路径分析，可以了解基本的目标或目标元素（我自己给的一个称呼）的设备路径。如某个目标完成之前有哪些设备路径、目标完成之后有哪些目标路径，或者目标前后的所有完整路径。目标元素是指：事件类别、事件操作、事件标签、网页等，目标包括：电商交易次数、你设置的目标。

3.对于电商来说，新增了一些类似于笔单价和客单价的指标。在此前由于GA默认是以cookie为单位进行统计，因此没有上述指标，但是加入用户的概念后，我们就可以计算出每位用户所带来的的平均收入（相当于客单价），每位用户的平均交易次数（相当于交易次数，因此你可以通过指标计算得出笔单价）。

4.流量获取设备是指：用户最常所用设备，以及分别对应的用户数、会话、最初所用设备带来的收入、其他设备带来的收入、该设备所产生的收入汇总。对于电商而言，还可以了解各个“最初所用设备”产生的交易次数、每位用户所带来的的平均收入，每位用户的平均交易次数等指标。概括来说，就是可以按设备对应用户的汇总数据，并且对应到用户所使用的第一个设备。这是一个比较复杂的对应关系，因此GA目前也只是做了第一个设备的行为及转化细分和汇总。

## 前提条件：

1.你需要升级到UA版本，GA版本是不支持这种跟踪的。各种GA的功能UA都支持，考虑尽快升级吧。

2.要有一套会员系统、或者唯一身份识别体系，用户使用不同设备都能识别出来，并且用户有登陆的习惯。一般来说，电商网站是最适合的了，当然只要你有会员体系和使用目标跟踪，就都适用。

3.用户要有登陆的习惯，最好是要有支持登陆的移动网站或APP，当前我们已经可以在一个账号内完整地查看web端和app端的数据了。

4.数据量要足够大，比如每日登陆会员一千或以上。因为User-ID视图相当于是一个过滤包含会员的数据视图，仅显示会员的数据，非会员的数据并不会显示，而且其他的视图并没有这种相关的报告。量小的话，User-ID视图筛选出来数据量太小很难分析出啥有代表性的数据来，很可能由于概率事件造成数据偏差。

## 如何使用：
User-ID功能的使用也比较简单，先在“媒体资源”的.JS跟踪信息设置中的User-ID子菜单中根据向导开通功能，然后在页面或者GTM中添加UID的跟踪代码即可。

GTM的话，在UA的代码设置中展开”要设置的字段“并设置为如下：

```字段名称为&uid 对应的值为UID的宏，即USER_ID```

其中UID为你设置的会员ID宏（名称为`USER_ID`），可以通过第一方cookie来提取、通过自定义javascript的宏进行提取、或者在页面前端新增相应的DataLayer再通过宏提取。

如果你直接使用UA的话，代码如下：

```ga(‘set’, ‘&uid’, USER_ID); // 使用已登录的 user_id 来设置用户 ID```

其中，USER_ID 的值是一个字符串，表示从您的系统中检索而来的唯一稳定 ID。

或

```ga('create', 'UA-XXXX-Y', { 'userId': 'USER_ID' });```


#关于会话统一

会话统一，通俗来说，就是我们是否在User-ID视图中记录当用户处于非登陆状态时候的行为，即：是否通过访客ID的记录进行用户的回溯及关联。

我们来想象一下这个例子（用户A使用一个浏览器，并且未清空cookie）：
1. 4月1日访问网站，未注册或登陆。
2. 4月2日访问网站，注册后登陆，之后退出登陆。
3. 4月3日访问访问，未登录访问网站。
4. 4月5日登陆，并购买商品下单。


如果不开启会话统一，在User-ID视图中我们将只能记录4月2日登陆后到退出前这一小段时间的数据。而开启会话统一的话，则4月1日到4月5日，以及之后的所有记录，均可被记录为是会员A的操作。


如果你在chrome浏览器的network中查看`http://www.google-analytics.com/collect?`的请求，看到URL中有&uid=[userid]这个参数，那么就说明代码设置是成功了。

接下来，开启“以用户为中心的数据分析”之旅吧~

#最后，来几张谍照：

![user-id-0](http://cdn.xiaoq.in/hub/user-id-0.png "User-ID启用设置")

![user-id-1](http://cdn.xiaoq.in/hub/user-id-1.png "User-ID设备重叠")

![user-id-1](http://cdn.xiaoq.in/hub/user-id-2.png "User-ID设备路径")

![user-id-1](http://cdn.xiaoq.in/hub/user-id-3.png "User-ID流量获取设备")
